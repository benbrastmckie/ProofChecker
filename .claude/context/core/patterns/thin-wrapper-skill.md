# Thin Wrapper Skill Pattern

**Version**: 2.0
**Updated**: 2026-01-25
**Purpose**: Quick reference for the thin wrapper skill pattern
**Audience**: /meta agent, skill developers

---

## Overview

Thin wrapper skills are the standard pattern for workflow skills. They:
1. Validate inputs from the calling command
2. Prepare delegation context
3. Invoke a subagent via Task tool
4. Return the subagent's text summary to the calling command

**IMPORTANT**: Skills do NOT handle checkpoints (preflight/postflight).
The calling command handles ALL state management operations.

They do NOT:
- Load heavy context (subagent does this)
- Execute business logic (subagent does this)
- Update state.json or TODO.md (command does this)
- Link artifacts (command does this)
- Create git commits (command does this)

---

## Frontmatter

```yaml
---
name: skill-{name}
description: {One-line description}
allowed-tools: Task
---
```

**Key fields**:
- `allowed-tools: Task` - Only tool needed for delegation
- No `context: fork` needed - skills don't load context
- No `agent:` field needed - delegation is explicit in skill body

---

## Execution Pattern

### 1. Input Validation

Validate inputs received from the calling command:

```bash
# Inputs come from command:
# - task_number: Task to operate on
# - session_id: Generated by command
# - task_dir: Created by command
# - Other operation-specific params

if [ -z "$task_number" ]; then
  return error "task_number is required"
fi
if [ -z "$session_id" ]; then
  return error "session_id is required"
fi
```

### 2. Context Preparation

Prepare delegation context for the subagent:

```json
{
  "session_id": "{session_id from command}",
  "delegation_depth": 1,
  "delegation_path": ["orchestrator", "{command}", "skill-{name}"],
  "timeout": {timeout_seconds},
  "task_context": {
    "task_number": N,
    "task_name": "{slug}",
    "description": "{description}",
    "language": "{language}"
  },
  "metadata_file_path": "{task_dir}/.meta/{operation}-return-meta.json"
}
```

### 3. Invoke Subagent

**CRITICAL**: Use the **Task** tool to spawn the subagent.

```
Tool: Task (NOT Skill)
Parameters:
  - subagent_type: "{agent-name}"
  - prompt: [Include task_context, delegation_context, metadata_file_path]
  - description: "Execute {operation} for task {N}"
```

**DO NOT** use `Skill({agent-name})` - this will FAIL.
Agents live in `.claude/agents/`, not `.claude/skills/`.

### 4. Return Brief Summary

Return the subagent's text summary to the calling command.
The subagent writes metadata to the file at `metadata_file_path`.
The command reads that metadata for postflight operations.

---

## Example: Thin Wrapper Skill

```markdown
---
name: skill-lean-research
description: Research Lean 4 and Mathlib for theorem proving tasks.
allowed-tools: Task
---

# Lean Research Skill

Thin wrapper that delegates Lean 4 research to `lean-research-agent` subagent.

**Note**: This skill does NOT handle checkpoints (preflight/postflight).
The calling command handles all state management operations.

## Trigger Conditions
- Task language is "lean"
- Research involves Mathlib, theorems, or proofs

## Inputs
- task_number: Task to research (required)
- session_id: Session tracking ID (from command)
- focus_prompt: Optional focus for research direction
- task_dir: Task directory path for artifacts

## Execution

### 1. Input Validation
Validate required inputs from command.

### 2. Prepare Delegation Context
Build delegation context with session_id from command.

### 3. Invoke Subagent
Use Task tool with subagent_type: lean-research-agent

### 4. Return Brief Summary
Return the subagent's text summary to calling command.
```

---

## Command Responsibility

The CALLING COMMAND handles all checkpoint operations:

| Operation | Responsibility | Location |
|-----------|---------------|----------|
| Generate session_id | Command | CHECKPOINT 1: GATE IN |
| Update to "in progress" status | Command | CHECKPOINT 1: GATE IN |
| Create task directory | Command | CHECKPOINT 1: GATE IN |
| Invoke skill | Command | STAGE 2: DELEGATE |
| Read metadata file | Command | CHECKPOINT 2: GATE OUT |
| Update to "completed" status | Command | CHECKPOINT 2: GATE OUT |
| Link artifacts | Command | CHECKPOINT 2: GATE OUT |
| Update TODO.md | Command | CHECKPOINT 2: GATE OUT |
| Git commit | Command | CHECKPOINT 3: COMMIT |

The SKILL only:
- Validates inputs
- Prepares delegation context
- Invokes subagent via Task tool
- Returns subagent's text summary

---

## When NOT to Use This Pattern

Use direct execution instead when:
- Skill executes atomic operations (skill-status-sync)
- No subagent needed
- Work is trivial

Direct execution skills use:
```yaml
allowed-tools: Bash, Edit, Read
```

---

## Related Documentation

- @.claude/context/core/patterns/checkpoint-in-commands.md - Command checkpoint pattern
- @.claude/context/core/formats/subagent-return.md - Return format (metadata file)
- @.claude/CLAUDE.md - Checkpoint-Based Execution Model section
