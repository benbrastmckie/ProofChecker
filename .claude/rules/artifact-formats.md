---
paths: specs/**/*
---

# Artifact Format Rules

## Placeholder Conventions

Placeholders in path templates and content follow these conventions:

| Placeholder | Format | Usage | Examples |
|-------------|--------|-------|----------|
| `{N}` | Unpadded integer | Task numbers, counts | `389`, `task 389:`, `{N}_{SLUG}` |
| `{NNN}` | 3-digit padded | Artifact versions | `001`, `research-001.md` |
| `{P}` | Unpadded integer | Phase numbers | `1`, `phase 1:` |
| `{DATE}` | YYYYMMDD | Date stamps in filenames | `20260111` |
| `{ISO_DATE}` | YYYY-MM-DD | ISO dates in content | `2026-01-11` |
| `{SLUG}` | snake_case | Task slug from title | `fix_bug_name` |

**Key distinction**: Task numbers (`{N}`) are unpadded because they grow indefinitely. Artifact versions (`{NNN}`) are padded because they rarely exceed 999 per task.

## Research Reports

**Location**: `specs/{N}_{SLUG}/reports/research-{NNN}.md`

```markdown
# Research Report: Task #{N}

**Task**: {title}
**Date**: {ISO_DATE}
**Focus**: {optional focus}

## Summary

{2-3 sentence overview}

## Findings

### {Topic}

{Details with evidence}

## Recommendations

1. {Actionable recommendation}

## References

- {Source with link if applicable}

## Next Steps

{What to do next}
```

## Implementation Plans

**Location**: `specs/{N}_{SLUG}/plans/implementation-{NNN}.md`

```markdown
# Implementation Plan: Task #{N}

**Task**: {title}
**Version**: {NNN}
**Created**: {ISO_DATE}
**Language**: {language}

## Overview

{Approach summary}

## Phases

### Phase 1: {Name}

**Dependencies**: None
**Estimated effort**: {hours}
**Status**: [NOT STARTED]

**Objectives**:
1. {Objective}

**Files to modify**:
- `path/to/file` - {changes}

**Steps**:
1. {Step}

**Verification**:
- {How to verify}

---

## Dependencies

- {Dependency}

## Risks and Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|

## Success Criteria

- [ ] {Criterion}
```

## Implementation Summaries

**Location**: `specs/{N}_{SLUG}/summaries/implementation-summary-{DATE}.md`

```markdown
# Implementation Summary: Task #{N}

**Completed**: {ISO_DATE}
**Duration**: {time}

## Changes Made

{Overview}

## Files Modified

- `path/to/file` - {change}

## Verification

- {What was verified}

## Notes

{Additional notes}
```

## Error Reports

**Location**: `specs/{N}_{SLUG}/reports/error-report-{DATE}.md`

Error reports are generated by the `/lake` command when unfixable build errors remain. Each file with errors gets its own task and error report.

```markdown
# Build Error Report: Task #{N}

**Generated**: {ISO_DATE}
**Source file**: {file_path}
**Error count**: {N} errors

## Errors

### Error 1: Line {line}
**Type**: {error|warning}
**Column**: {column}
**Message**:
```
{full_error_message}
```

### Error 2: Line {line}
...

## Suggested Approach

Review the error messages above and apply appropriate fixes.
Common patterns:
- Type mismatches: Check the expected vs actual types
- Unknown identifiers: Verify imports and namespaces
- Proof failures: May need additional hypotheses or different tactics

After fixing, run `/lake` again to verify the build passes.
```

**Notes**:
- Error reports use date-based naming (like summaries) since each report is a snapshot
- Reports are linked as artifacts in state.json with type `"error_report"`
- The Source field in the task entry links back to the affected file

## Team Artifacts

Team workflows (`/research --team`, `/plan --team`, `/implement --team`) create intermediate artifacts that must correlate with their synthesized outputs. All team artifacts include a run number (`{RRR}`) to associate teammate outputs with their synthesis run.

### Run Number Determination

Before spawning teammates, the lead calculates the next run number by counting existing synthesis artifacts:

```bash
# For research: count existing research-*.md files
run_num=$(ls specs/${N}_${SLUG}/reports/research-[0-9][0-9][0-9].md 2>/dev/null | wc -l)
run_num=$((run_num + 1))
run_padded=$(printf "%03d" $run_num)

# For planning: count existing implementation-*.md files
run_num=$(ls specs/${N}_${SLUG}/plans/implementation-[0-9][0-9][0-9].md 2>/dev/null | wc -l)
run_num=$((run_num + 1))
run_padded=$(printf "%03d" $run_num)
```

### Team Research Artifacts

| Artifact | Path Pattern | Example |
|----------|--------------|---------|
| Teammate findings | `specs/{N}_{SLUG}/reports/research-{RRR}-teammate-{letter}-findings.md` | `research-001-teammate-a-findings.md` |
| Synthesized report | `specs/{N}_{SLUG}/reports/research-{RRR}.md` | `research-001.md` |

**Correlation example**:
```
Run 1:
  research-001-teammate-a-findings.md  -> synthesized to -> research-001.md
  research-001-teammate-b-findings.md  ->                -> research-001.md
  research-001-teammate-c-findings.md  ->                -> research-001.md

Run 2:
  research-002-teammate-a-findings.md  -> synthesized to -> research-002.md
  research-002-teammate-b-findings.md  ->                -> research-002.md
```

### Team Planning Artifacts

| Artifact | Path Pattern | Example |
|----------|--------------|---------|
| Candidate plan | `specs/{N}_{SLUG}/plans/plan-{RRR}-candidate-{letter}.md` | `plan-001-candidate-a.md` |
| Risk analysis | `specs/{N}_{SLUG}/plans/plan-{RRR}-risk-analysis.md` | `plan-001-risk-analysis.md` |
| Synthesized plan | `specs/{N}_{SLUG}/plans/implementation-{RRR}.md` | `implementation-001.md` |

**Correlation example**:
```
Run 1:
  plan-001-candidate-a.md    -> synthesized to -> implementation-001.md
  plan-001-candidate-b.md    ->                -> implementation-001.md
  plan-001-risk-analysis.md  ->                -> implementation-001.md
```

### Team Implementation Artifacts

| Artifact | Path Pattern | Example |
|----------|--------------|---------|
| Phase results | `specs/{N}_{SLUG}/phases/impl-{RRR}-phase-{P}-results.md` | `impl-001-phase-2-results.md` |
| Debug hypothesis | `specs/{N}_{SLUG}/debug/impl-{RRR}-debug-{DDD}-hypothesis.md` | `impl-001-debug-001-hypothesis.md` |
| Debug analysis | `specs/{N}_{SLUG}/debug/impl-{RRR}-debug-{DDD}-analysis.md` | `impl-001-debug-001-analysis.md` |
| Debug resolution | `specs/{N}_{SLUG}/debug/impl-{RRR}-debug-{DDD}-resolution.md` | `impl-001-debug-001-resolution.md` |
| Synthesized summary | `specs/{N}_{SLUG}/summaries/implementation-summary-{DATE}.md` | `implementation-summary-20260217.md` |

The implementation run number (`{RRR}`) comes from the plan version being implemented (e.g., `implementation-001.md` -> `impl-001-*`).

### Placeholder Legend

| Placeholder | Format | Description |
|-------------|--------|-------------|
| `{RRR}` | 3-digit padded | Run number (001, 002, ...) |
| `{letter}` | lowercase | Teammate identifier (a, b, c, d) |
| `{P}` | unpadded integer | Phase number (1, 2, 3, ...) |
| `{DDD}` | 3-digit padded | Debug cycle number (001, 002, ...) |

### Backward Compatibility

Existing artifacts without run numbers are valid. The new naming scheme applies to future team runs only. Synthesis artifacts (`research-{NNN}.md`, `implementation-{NNN}.md`, `implementation-summary-{DATE}.md`) retain their existing names.

## Phase Status Markers

Use in plan files:
- `[NOT STARTED]` - Phase not begun
- `[IN PROGRESS]` - Currently executing
- `[COMPLETED]` - Phase finished
- `[PARTIAL]` - Partially complete (interrupted)
- `[BLOCKED]` - Cannot proceed

## Progress Subsection

Each phase in a plan file may include a **Progress:** subsection to track work done across implementation sessions. This provides a canonical record of implementation progress directly in the plan file.

### Format

```markdown
**Progress:**

**Session: YYYY-MM-DD, sess_NNNNNN_XXXXXX**
- Added: `lemma_name` - description
- Fixed: `function_name` by adding precondition
- Completed: `objective_name` (was N sorries, now 0)
- Sorries: 18 -> 14 (4 eliminated)

**Session: YYYY-MM-DD, sess_NNNNNN_YYYYYY** (no progress)
- Attempted: approach description
- Result: blocked by issue
- No changes committed
```

### Session Header

Each implementation session gets a header with:
- **Date**: In YYYY-MM-DD format
- **Session ID**: The session_id from delegation context (sess_NNNNNN_XXXXXX)

### Action Verbs

Use these standard action verbs for consistency:

| Verb | Usage |
|------|-------|
| `Added` | New lemma, theorem, function, or file created |
| `Fixed` | Bug fix, error correction, or issue resolution |
| `Completed` | Objective or sub-goal fully finished |
| `Removed` | Deleted code, deprecated functionality |
| `Refactored` | Code reorganization without behavior change |
| `Attempted` | Tried an approach (for no-progress sessions) |

### Outcome Tracking

For Lean tasks, track sorry/axiom delta using the format:
- `Sorries: N -> M (K eliminated)` - where K = N - M
- `Axioms: N -> M (K eliminated)` - for axiom reduction

### No-Progress Sessions

When a session makes no progress, document it to prevent successor retries:

```markdown
**Session: YYYY-MM-DD, sess_NNNNNN_XXXXXX** (no progress)
- Attempted: description of what was tried
- Result: why it failed or was blocked
- No changes committed
```

### Example from Task 881

```markdown
**Progress:**

**Session: 2026-02-16, sess_1771302929_655861**
- Added: `buildSeedAux_preserves_mem_general` (key monotonicity lemma)
- Added: `buildSeedAux_preserves_modal_backward` (Box preservation)
- Completed: Phase 1 monotonicity objectives
- Sorries: 18 -> 11 (7 eliminated)

**Session: 2026-02-17, sess_1771386000_abc123** (no progress)
- Attempted: induction on world index for consistency
- Result: blocked by mutual consistency requirement between worlds
- No changes committed
```

### Placement

The Progress subsection should appear:
- After the phase's **Verification:** section (if present)
- Before the horizontal rule (`---`) separating phases
- Only in phases that have been started ([IN PROGRESS], [COMPLETED], or [PARTIAL])

## Versioning

### Research Reports
Increment: research-001.md, research-002.md
- Multiple reports for same task allowed
- Later reports supplement earlier ones

### Plans
Increment: implementation-001.md, implementation-002.md
- New version = revised approach
- Previous versions preserved for history

### Summaries
Date-based: implementation-summary-20260109.md
- One per completion
- Includes all phases
