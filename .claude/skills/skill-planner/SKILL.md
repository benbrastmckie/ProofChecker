---
name: skill-planner
description: Create phased implementation plans from research findings. Invoke when a task needs an implementation plan.
allowed-tools: Task
---

# Planner Skill

Thin wrapper that delegates plan creation to `planner-agent` subagent.

**Note**: This skill does NOT handle checkpoints (preflight/postflight).
The calling command handles all state management operations.

## Trigger Conditions

This skill activates when:
- Task status allows planning (not_started, researched)
- /plan command is invoked
- Implementation approach needs to be formalized

---

## Inputs

- `task_number` - Task to plan (required)
- `session_id` - Session tracking ID (from command)
- `task_dir` - Task directory path for artifacts
- `research_path` - Path to research report (if exists)

---

## Execution

### 1. Input Validation

Validate required inputs from command:

```bash
# All inputs come from the calling command
# - task_number: verified by command
# - session_id: generated by command
# - task_dir: created by command
# - research_path: optional

if [ -z "$task_number" ]; then
  return error "task_number is required"
fi
if [ -z "$session_id" ]; then
  return error "session_id is required"
fi
```

### 2. Prepare Delegation Context

Prepare delegation context for the subagent:

```json
{
  "session_id": "{session_id from command}",
  "delegation_depth": 1,
  "delegation_path": ["orchestrator", "plan", "skill-planner"],
  "timeout": 1800,
  "task_context": {
    "task_number": N,
    "task_name": "{project_name}",
    "description": "{description}",
    "language": "{language}"
  },
  "research_path": "{path to research report if exists}",
  "metadata_file_path": "{task_dir}/.meta/plan-return-meta.json"
}
```

### 3. Invoke Subagent

**CRITICAL**: You MUST use the **Task** tool to spawn the subagent.

**Required Tool Invocation**:
```
Tool: Task (NOT Skill)
Parameters:
  - subagent_type: "planner-agent"
  - prompt: [Include task_context, delegation_context, research_path, metadata_file_path]
  - description: "Execute planning for task {N}"
```

**DO NOT** use `Skill(planner-agent)` - this will FAIL.

The subagent will:
- Load planning context files
- Analyze task requirements and research
- Decompose into logical phases
- Identify risks and mitigations
- Create plan in `{task_dir}/plans/`
- Write metadata to `{task_dir}/.meta/plan-return-meta.json`
- Return a brief text summary (NOT JSON)

### 4. Return Brief Summary

Return the subagent's text summary to the calling command.
The command handles metadata reading and postflight operations.

---

## Return Format

This skill returns the **subagent's brief text summary** directly to the calling command.

The command then:
1. Reads the metadata file at `{task_dir}/.meta/plan-return-meta.json`
2. Updates state.json status to "planned"
3. Updates TODO.md status to [PLANNED]
4. Links plan artifact
5. Creates git commit

---

## Error Handling

### Input Validation Errors
Return immediately with error message if required inputs missing.

### Subagent Errors
Return the subagent's error text to the calling command.
Command decides how to handle (keep status, log error).

### Timeout
Return partial status text if subagent times out.
Command handles status preservation.
