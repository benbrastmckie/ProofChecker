---
name: skill-document-converter
description: Document conversion routing with dual invocation support
allowed-tools: Task
---

# Document Converter Skill

Thin wrapper that delegates document conversion to `document-converter-agent` subagent.

**Note**: This skill does NOT handle checkpoints (preflight/postflight).
The calling command handles git commit (if requested).

## Trigger Conditions

This skill activates when:

### Direct Invocation
- User explicitly runs `/convert` command
- User requests file format conversion in conversation

### Implicit Invocation (during task implementation)

When an implementing agent encounters any of these patterns:

**Plan step language patterns**:
- "Extract text from [file].pdf"
- "Convert [file] to markdown"
- "Convert [file] to PDF"
- "Generate PDF from [documentation/file]"

**File extension detection**:
- Source file has extension: `.pdf`, `.docx`, `.xlsx`, `.pptx`, `.html`
- Target mentions: "markdown", ".md", "PDF", ".pdf"

### When NOT to trigger

Do not invoke for:
- Reading source code files (.py, .js, .lean, etc.)
- Viewing images without extraction
- Operations that don't involve format conversion
- Files already in the target format

---

## Inputs

- `source_path` - Source file path (required)
- `output_path` - Output file path (required)
- `session_id` - Session tracking ID (from command)

---

## Execution

### 1. Input Validation

Validate required inputs from command:

```bash
# All inputs come from the calling command
# - source_path: validated by command (file exists)
# - output_path: determined by command (inferred or explicit)
# - session_id: generated by command

if [ -z "$source_path" ]; then
  return error "source_path is required"
fi
if [ -z "$output_path" ]; then
  return error "output_path is required"
fi
if [ -z "$session_id" ]; then
  return error "session_id is required"
fi
```

### 2. Prepare Delegation Context

Prepare delegation context for the subagent:

```json
{
  "source_path": "/absolute/path/to/source.pdf",
  "output_path": "/absolute/path/to/output.md",
  "metadata": {
    "session_id": "sess_{timestamp}_{random}",
    "delegation_depth": 1,
    "delegation_path": ["orchestrator", "convert", "skill-document-converter"]
  },
  "metadata_file_path": "{output_dir}/.convert-return-meta.json"
}
```

### 3. Invoke Subagent

**CRITICAL**: You MUST use the **Task** tool to spawn the subagent.

**Required Tool Invocation**:
```
Tool: Task (NOT Skill)
Parameters:
  - subagent_type: "document-converter-agent"
  - prompt: [Include source_path, output_path, metadata, metadata_file_path]
  - description: "Convert {source_path} to {output_path}"
```

**DO NOT** use `Skill(document-converter-agent)` - this will FAIL.

The subagent will:
- Detect available conversion tools
- Determine conversion direction from file extensions
- Execute conversion with appropriate tool
- Validate output exists and is non-empty
- Write metadata to `{output_dir}/.convert-return-meta.json`
- Return a brief text summary (NOT JSON)

### 4. Return Brief Summary

Return the subagent's text summary to the calling command.
The command handles metadata reading and optional git commit.

---

## Return Format

This skill returns the **subagent's brief text summary** directly to the calling command.

The command then:
1. Reads the metadata file at `{output_dir}/.convert-return-meta.json`
2. Verifies output file exists
3. If git commit requested: creates commit
4. Presents results to user

---

## Error Handling

### Input Validation Errors
Return immediately with error message if source file not found or path invalid.

### Unsupported Format
Return error with clear message about supported formats.

### Subagent Errors
Return the subagent's error text to the calling command.

### Tool Not Available
Return error with installation instructions.
