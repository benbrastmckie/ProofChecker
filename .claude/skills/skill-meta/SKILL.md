---
name: skill-meta
description: Interactive system builder. Invoke for /meta command to create tasks for .claude/ system changes.
allowed-tools: Task
---

# Meta Skill

Thin wrapper that delegates system building to `meta-builder-agent` subagent. This skill handles all three modes of /meta: interactive interview, prompt analysis, and system analysis.

**Note**: This skill does NOT handle checkpoints (preflight/postflight).
The calling command handles all state management operations (git commits when tasks are created).

## Trigger Conditions

This skill activates when:
- /meta command is invoked (with any arguments)
- User requests system building or task creation for .claude/ changes
- System analysis is requested (--analyze flag)

---

## Inputs

- `mode` - One of: "interactive", "prompt", "analyze"
- `session_id` - Session tracking ID (from command)
- `prompt` - User prompt (if mode="prompt")

---

## Execution

### 1. Input Validation

Validate required inputs from command:

```bash
# All inputs come from the calling command
# - mode: determined by command from arguments
# - session_id: generated by command
# - prompt: user input (for prompt mode only)

if [ -z "$mode" ]; then
  return error "mode is required"
fi
if [ -z "$session_id" ]; then
  return error "session_id is required"
fi
```

### 2. Prepare Delegation Context

Prepare delegation context for the subagent:

```json
{
  "session_id": "{session_id from command}",
  "delegation_depth": 1,
  "delegation_path": ["orchestrator", "meta", "skill-meta"],
  "timeout": 7200,
  "mode": "interactive|prompt|analyze",
  "prompt": "{user prompt if mode=prompt, null otherwise}"
}
```

### 3. Invoke Subagent

**CRITICAL**: You MUST use the **Task** tool to spawn the subagent.

**Required Tool Invocation**:
```
Tool: Task (NOT Skill)
Parameters:
  - subagent_type: "meta-builder-agent"
  - prompt: [Include mode, prompt if provided, delegation_context]
  - description: "Execute meta building in {mode} mode"
```

**DO NOT** use `Skill(meta-builder-agent)` - this will FAIL.

The subagent will:
- Load component guides on-demand based on mode
- Execute mode-specific workflow:
  - **Interactive**: Run 7-stage interview with AskUserQuestion
  - **Prompt**: Analyze request and propose task breakdown
  - **Analyze**: Inventory existing components and provide recommendations
- Create task entries (TODO.md, state.json, task directories) for non-analyze modes
- Write metadata to `specs/.meta/meta-return-meta.json`
- Return a brief text summary (NOT JSON)

### 4. Return Brief Summary

Return the subagent's text summary to the calling command.
The command handles metadata reading and git commit.

---

## Return Format

This skill returns the **subagent's brief text summary** directly to the calling command.

The command then:
1. Reads the metadata file at `specs/.meta/meta-return-meta.json`
2. If tasks were created: creates git commit
3. Presents results to user

---

## Error Handling

### Input Validation Errors
Return immediately with error message if required inputs missing.

### Subagent Errors
Return the subagent's error text to the calling command.

### User Cancellation
Return completed status (not failed) when user explicitly cancels at confirmation stage.

### Timeout
Return partial status if subagent times out (default 7200s for interactive sessions).
